@using System.Globalization
@inject NavigationManager Navigation
@inject IJSRuntime JS

<div class="language-switcher">
    <div class="culture-selector">
        @foreach (var lang in Languages)
        {
            <button class="culture-button @(CurrentLanguage == lang.Code ? "active" : "")"
                    @onclick="() => OnLanguageChanged(lang.Code)">
                <span class="flag-icon flag-icon-@lang.Flag"></span>
                <span class="culture-code">@lang.ShortName</span>
            </button>
        }
    </div>
</div>

@code {
    private string CurrentLanguage => CultureInfo.CurrentUICulture.Name;

    private List<LanguageOption> Languages = new()
    {
        new LanguageOption { Code = "pl-PL", ShortName = "PL", Flag = "pl", Name = "Polski" },
        new LanguageOption { Code = "en-US", ShortName = "EN", Flag = "us", Name = "English" }
    };

    private void OnLanguageChanged(string newLanguage)
    {
        if (newLanguage == CurrentLanguage) return;

        // Zapisz wybór w localStorage
        _ = JS.InvokeVoidAsync("localStorage.setItem", "culture", newLanguage);

        // Przeładuj stronę z nową kulturą
        Navigation.NavigateTo(Navigation.Uri, forceLoad: true);
    }

    public class LanguageOption
    {
        public string Code { get; set; } = string.Empty;
        public string ShortName { get; set; } = string.Empty;
        public string Flag { get; set; } = string.Empty;
        public string Name { get; set; } = string.Empty;
    }
}